diff -uNr cronie-1.7.0/src/do_command.c cronie-1.7.0.mod/src/do_command.c
--- cronie-1.7.0/src/do_command.c	2023-10-13 16:38:39.000000000 +0800
+++ cronie-1.7.0.mod/src/do_command.c	2023-10-14 11:29:23.018891858 +0800
@@ -264,7 +264,7 @@
 		 */
 		{
 			char *shell = env_get("SHELL", jobenv);
-			int fd, fdmax = TMIN(getdtablesize(), MAX_CLOSE_FD);
+			int fd, fdmax = TMIN(sysconf(_SC_OPEN_MAX), MAX_CLOSE_FD);
 			DIR *dir;
 			struct dirent *dent;
 
diff -uNr cronie-1.7.0/src/popen.c cronie-1.7.0.mod/src/popen.c
--- cronie-1.7.0/src/popen.c	2023-03-13 16:20:25.000000000 +0800
+++ cronie-1.7.0.mod/src/popen.c	2023-10-14 11:29:46.146891849 +0800
@@ -79,7 +79,7 @@
 		return (NULL);
 
 	if (!pids) {
-		if ((fds = getdtablesize()) <= 0)
+		if ((fds = sysconf(_SC_OPEN_MAX)) <= 0)
 			return (NULL);
 		if (fds > MAX_CLOSE_FD)
 			fds = MAX_CLOSE_FD; /* avoid allocating too much memory */
