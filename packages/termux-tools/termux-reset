#!/bin/bash

echo
echo "You are going to reset your Termux installation."
echo
echo "This script will erase everything under \$PREFIX. All files under that directory will be lost, that includes packages, configuration files, databases, etc."
echo
echo "Termux home directory as well as data on your shared or external storage will not be removed and leaved as-is."
echo

read -re -p "Do you want to continue ? (y/n) " CHOICE

if ! [[ $CHOICE =~ (Y|y) ]]; then
	echo "Leaving intact the contents of \$PREFIX"
	exit 1
else
	echo "Erasing '@TERMUX_PREFIX@'..."
	rm -rf "@TERMUX_PREFIX@"
	echo "Done. You need to close Termux application now."

	# Prefix is now gone.
	unset LD_PRELOAD LD_LIBRARY_PATH
	if [ -x "/system/bin/killall" ]; then
		echo "Terminating all sessions..."
		/system/bin/killall -9 "$SHELL"
	fi
fi
